!function(t,i){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","free-jqgrid-plugins/ui.multiselect","jquery-ui/dialog","jquery-ui/draggable","jquery-ui/droppable","jquery-ui/resizable","jquery-ui/sortable"],function(e){return i(e,t,t.document)}):"object"==typeof module&&module.exports?module.exports=function(e,t){return e||(e=window),void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),require("./grid.base"),require("free-jqgrid-plugins/ui.multiselect"),require("jquery-ui/dialog"),require("jquery-ui/draggable"),require("jquery-ui/droppable"),require("jquery-ui/resizable"),require("jquery-ui/sortable"),i(t,e,e.document),t}:i(jQuery,t,t.document)}("undefined"!=typeof window?window:this,function(x,F,s){"use strict";var H=x.jgrid,M=H.jqID,z=null!=x.ui?x.ui.multiselect:null,S=function(i){if(null!=this.grid&&null!=this.grid.p){var o,e,t,r,n,d=this,a=this.grid.p,l=this.gh,s=this.selectedList,u=this.inGroup,c=s.find("li"),p=c.length-1,h=function(e,t,i){var o,r,n=s.find("li");for(void 0===t&&(t=i?n.length-1:0),o=t;i?0<=o:o<n.length;i?o--:o++)if((r=x(n[o]).data("optionLink"))&&e.call(n[o],parseInt(r.val(),10),o))return o},g=function(){0<=(e=x.inArray(a.colModel[i].name,d.newColOrder))&&d.newColOrder.splice(e,1),c=s.find("li"),o=0,h(function(e,t){if(e===i){for(p=t;0<=o&&o<a.colModel.length&&o!==i&&(a.colModel[o].hidden||a.colModel[o].hidedlg)&&(null==u||u[o]===u[i]);)o++;return d.newColOrder.splice(o,0,a.colModel[i].name),!0}(o=x.inArray(a.colModel[e].name,d.newColOrder,o))<0&&(o=x.inArray(a.colModel[e].name,d.newColOrder)),o++})},f=function(e){if(u[e]===u[i])return x(this).after(c[p]),g(),!0},m=function(e){if(u[e]===u[i])return x(this).before(c[p]),g(),!0},b=function(e){if(u[e]===u[i]&&void 0!==u[e])return l[u[e]].startColumnName=a.colModel[e].name,!0};if(g(),l&&void 0!==l[u[i]]){for(r=l[u[i]],e=0;e<r.numberOfColumns;e++)if(o=a.iColByName[r.startColumnName]+e,!a.colModel[o].hidden&&!a.colModel[o].hidedlg){h(f,p-1,!0),h(m,p+1),h(b);break}}else if(l){if(c=s.find("li"),(e=h(function(e){if(e===i)return!0}))+1>=c.length||e<0)return;if((n=x(c[e+1]).data("optionLink"))&&void 0!==(t=u[parseInt(n.val(),10)])&&(n=x(c[e-1]).data("optionLink"))&&u[parseInt(n.val(),10)]===t){var v=h(function(e){if(u[e]!==t)return!0},e+1);x(c[void 0===v||v>=c.length?c.length-1:v-1]).after(c[p]),g()}}}};if(H.msie&&8===H.msiever()&&(x.expr[":"].hidden=function(e){return 0===e.offsetWidth||0===e.offsetHeight||"none"===e.style.display}),H._multiselect=!1,z){if(z.prototype._setSelected){var n=z.prototype._setSelected;z.prototype._setSelected=function(e,t){var i=n.call(this,e,t),o=this.element,r=parseInt(e.data("optionLink").val(),10);return t&&this.selectedList&&(S.call(this,r),this.selectedList.find("li").each(function(){x(this).data("optionLink")&&x(this).data("optionLink").remove().appendTo(o)})),i}}z.prototype.destroy&&(z.prototype.destroy=function(){var e=this;e.element.show(),e.container.remove(),void 0===x.Widget?x.widget.prototype.destroy.apply(e,arguments):x.Widget.prototype.destroy.apply(e,arguments)}),H._multiselect=!0}H.extend({sortableColumns:function(l){return this.each(function(){var n=this,d=n.p,e=M(d.id);if(d&&d.sortable&&x.jgrid.isFunction(x.fn.sortable)){var t={tolerance:"pointer",axis:"x",scrollSensitivity:"1",items:">th:not(:has(#jqgh_"+e+"_cb,#jqgh_"+e+"_rn,#jqgh_"+e+"_subgrid),:hidden)",placeholder:{element:function(e){return x(s.createElement(e[0].nodeName)).addClass(e[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0]},update:function(e,t){t.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),t.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10))}},start:function(){n.grid.hDiv.scrollLeft=n.grid.bDiv.scrollLeft},update:function(e,t){var i=x(">th",x(t.item).parent()),o=d.id+"_",r=[];i.each(function(){var e=x(">div",this).get(0).id.replace(/^jqgh_/,"").replace(o,""),t=d.iColByName[e];void 0!==t&&r.push(t)}),x(n).jqGrid("remapColumns",r,!0,!0),x.jgrid.isFunction(d.sortable.update)&&d.sortable.update(r),setTimeout(function(){d.disableClick=!1},50)}};if(d.sortable.options?x.extend(t,d.sortable.options):x.jgrid.isFunction(d.sortable)&&(d.sortable={update:d.sortable}),t.start){var i=t.start;t.start=function(e,t){a(),i.call(this,e,t)}}else t.start=a;d.sortable.exclude&&(t.items+=":not("+d.sortable.exclude+")");var o=l.sortable(t),r=o.data("sortable")||o.data("uiSortable")||o.data("ui-sortable");null!=r&&(r.floating=!0)}function a(){d.disableClick=!0}})},columnChooser:function(n){var t,d,e,i,o,a,r,l,s=this,u=s[0],c=u.p,p=c.colModel,h=p.length,g=c.colNames,f=function(e){return z&&z.prototype&&e.data(z.prototype.widgetFullName||z.prototype.widgetName)||e.data("ui-multiselect")||e.data("multiselect")},m=function(e,t){return s.jqGrid("getGuiStyles",e,t)};if(t="#colchooser_"+M(c.id),!x(t).length){if(o=x('<div id="colchooser_'+c.id+'"><div class="'+m("dialog.body")+'"><select multiple="multiple"></select></div></div>'),l=x('<div class="'+m("dialog.footer")+'" style="text-align:right;"></div>').appendTo(o),d=x("select",o),n=x.extend({width:"auto",height:"auto",classname:null,done:function(e){e&&s.jqGrid("remapColumns",e,!0)},msel:"multiselect",dlog:function(e){if("destroy"!==e){var i=s.jqGrid("getGuiStyles","states.hover");x.each(e.buttons,function(e,t){x('<button class="'+H.mergeCssClasses("fm-button","fm-button-margin",s.jqGrid("getGuiStyles","dialog.fmButton"+name),s.jqGrid("getGuiStyles","dialog.defaultCorner"+name))+'">'+e+"</button>").on("click",t).hover(function(){x(this).addClass(i)},function(){x(this).removeClass(i)}).appendTo(l)}),H.createModal.call(s,{themodal:"colchooser_"+c.id,modalhead:"colchooser_head",modalcontent:"colchooser_content"},o,n,"","",!0),H.viewModal.call(s,t,{onHide:function(e){e.w.remove(),e.o&&e.o.remove()}})}else H.hideModal.call(s,t)},dialog_opts:{},dlog_opts:function(e){var t={};return t[e.bSubmit]=function(){e.apply_perm(),e.cleanup(!1)},t[e.bCancel]=function(){e.cleanup(!0)},x.extend(!0,{title:e.caption,buttons:t,close:function(){e.cleanup(!0)},modal:e.modal||!1,resizable:e.resizable||!0,width:e.width+70,resize:function(){var e=f(d),t=e.container.closest(".ui-dialog-content");0<t.length&&"object"==typeof t[0].style?t[0].style.width="":t.css("width",""),e.selectedList.height(Math.max(e.selectedContainer.height()-e.selectedActions.outerHeight()-1,1)),e.availableList.height(Math.max(e.availableContainer.height()-e.availableActions.outerHeight()-1,1))}},e.dialog_opts||{})},apply_perm:function(){var e,t,i=new Array(c.colModel.length),o={notSkipFrozen:void 0!==n.notSkipFrozen&&n.notSkipFrozen,skipSetGridWidth:!0,skipSetGroupHeaders:!0};for(e=0;e<c.colModel.length;e++)i[e]=c.iColByName[a.newColOrder[e]];if(x("option",d).each(function(){x(this).is(":selected")?s.jqGrid("showCol",p[this.value].name,o):s.jqGrid("hideCol",p[this.value].name,o)}),n.done&&n.done.call(s,i),c.groupHeader&&("object"==typeof c.groupHeader||x.jgrid.isFunction(c.groupHeader)))if(s.jqGrid("destroyGroupHeader",!1),c.groupHeader.groupHeaders=a.gh,null!=c.pivotOptions&&null!=c.pivotOptions.colHeaders&&1<c.pivotOptions.colHeaders.length)for(t=c.pivotOptions.colHeaders,e=0;e<t.length;e++)t[e]&&t[e].groupHeaders.length&&s.jqGrid("setGroupHeaders",t[e]);else s.jqGrid("setGroupHeaders",c.groupHeader);var r=c.autowidth||void 0!==c.widthOrg&&"auto"!==c.widthOrg&&"100%"!==c.widthOrg?c.width:c.tblwidth;r!==c.width&&s.jqGrid("setGridWidth",r,c.shrinkToFit)},cleanup:function(e){C(n.msel,d,"destroy"),C(n.dlog,o,"destroy"),o.remove(),e&&n.done&&n.done.call(s)},msel_opts:{guiStyle:c.guiStyle,iconSet:c.iconSet,locale:c.locale}},s.jqGrid("getGridRes","col"),H.col,n||{}),x.ui&&z&&z.defaults){if(!H._multiselect)return void(null!=H.defaults&&x.jgrid.isFunction(H.defaults.fatalError)?H.defaults.fatalError:alert)("Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!");n.msel_opts=x.extend(z.defaults,n.msel_opts)}n.classname&&(o.addClass(n.classname),d.addClass(n.classname)),n.width&&(x(">div",o).css({width:n.width,margin:"0 auto"}),d.css("width",n.width)),n.height&&(x(">div",o).css("height",n.height),d.css("height",n.height-10)),d.empty();var b,v,j,y,_=null!=c.groupHeader?c.groupHeader.groupHeaders:0,w={};if(_)for(b=0;b<_.length;b++)for(y=_[b],v=0;v<y.numberOfColumns;v++)j=c.iColByName[y.startColumnName]+v,w[j]=x.jgrid.isFunction(n.buildItemText)?n.buildItemText.call(s[0],{iCol:j,cm:p[j],cmName:p[j].name,colName:g[j],groupTitleText:y.titleText}):x.jgrid.stripHtml(y.titleText)+": "+x.jgrid.stripHtml(""===g[j]?p[j].name:g[j]);for(j=0;j<h;j++)void 0===w[j]&&(w[j]=x.jgrid.isFunction(n.buildItemText)?n.buildItemText.call(s[0],{iCol:j,cm:p[j],cmName:p[j].name,colName:g[j],groupTitleText:null}):x.jgrid.stripHtml(g[j]));if(x.each(p,function(e){this.hidedlg||d.append("<option value='"+e+"'"+(c.headertitles||this.headerTitle?" title='"+H.stripHtml("string"==typeof this.headerTitle?this.headerTitle:w[e])+"'":"")+(this.hidden?"":" selected='selected'")+">"+w[e]+"</option>")}),e=x.jgrid.isFunction(n.dlog_opts)?n.dlog_opts.call(s,n):n.dlog_opts,C(n.dlog,o,e),i=x.jgrid.isFunction(n.msel_opts)?n.msel_opts.call(s,n):n.msel_opts,C(n.msel,d,i),a=f(d)){var q,G;if(a.grid=u,_)for(a.gh=x.extend(!0,[],_),a.inGroup=new Array(c.colModel.length),q=0;q<_.length;q++)for(G=_[q],j=0;j<G.numberOfColumns;j++)a.inGroup[c.iColByName[G.startColumnName]+j]=q;a.newColOrder=x.map(p,function(e){return e.name}),a.selectedList.css("height","auto"),a.availableList.css("height","auto"),r=Math.max(a.selectedList.height(),a.availableList.height()),r=Math.min(r,x(F).height()),a.selectedList.css("height",r),a.availableList.css("height",r),null!=a.options&&a.options.sortable&&a.selectedList.on("sortupdate",function(e,t){S.call(a,parseInt(t.item.data("optionLink").val(),10)),t.item.css({width:"",height:""}),x.jgrid.isFunction(n.sortUpdate)&&n.sortUpdate.call(u,e,t)}),x.jgrid.isFunction(n.init)&&n.init.call(u,a)}}function C(e,t){e&&("string"==typeof e?x.fn[e]&&x.fn[e].apply(t,x.makeArray(arguments).slice(2)):x.jgrid.isFunction(e)&&e.apply(t,x.makeArray(arguments).slice(2)))}},sortableRows:function(d){return this.each(function(){var o=this,r=o.grid,n=o.p;r&&(n.treeGrid||x.fn.sortable&&((d=x.extend({cursor:"move",axis:"y",items:">tbody>.jqgrow"},d||{})).start&&x.jgrid.isFunction(d.start)?(d._start_=d.start,delete d.start):d._start_=!1,d.update&&x.jgrid.isFunction(d.update)?(d._update_=d.update,delete d.update):d._update_=!1,d.start=function(e,t){if(x(t.item).css("border-width","0"),x("td",t.item).each(function(e){this.style.width=r.cols[e].style.width}),n.subGrid){var i=x(t.item).attr("id");try{x(o).jqGrid("collapseSubGridRow",i)}catch(e){}}d._start_&&d._start_.apply(this,[e,t])},d.update=function(e,t){x(t.item).css("border-width",""),!0===n.rownumbers&&x("td.jqgrid-rownum",o.rows).each(function(e){x(this).html(e+1+(parseInt(n.page,10)-1)*parseInt(n.rowNum,10))}),d._update_&&d._update_.apply(this,[e,t])},x(o).sortable(d)))})},gridDnD:function(o){return this.each(function(){var e,t,f=this;if(f.grid&&!f.p.treeGrid&&x.fn.draggable&&x.fn.droppable){if(void 0===x("#jqgrid_dnd")[0]&&x("body").append("<table id='jqgrid_dnd' class='ui-jqgrid-dnd'></table>"),"string"!=typeof o||"updateDnD"!==o||!0!==f.p.jqgdnd){if((o=x.extend({drag:function(r){return x.extend({start:function(e,t){var i,o;if(f.p.subGrid){o=x(t.helper).attr("id");try{x(f).jqGrid("collapseSubGridRow",o)}catch(e){}}for(i=0;i<x.data(f,"dnd").connectWith.length;i++)0===x(x.data(f,"dnd").connectWith[i]).jqGrid("getGridParam","reccount")&&x(x.data(f,"dnd").connectWith[i]).jqGrid("addRowData","jqg_empty_row",{});t.helper.addClass("ui-state-highlight"),x("td",t.helper).each(function(e){this.style.width=f.grid.headers[e].width+"px"}),r.onstart&&x.jgrid.isFunction(r.onstart)&&r.onstart.call(x(f),e,t)},stop:function(e,t){var i,o;for(t.helper.dropped&&!r.dragcopy&&(void 0===(o=x(t.helper).attr("id"))&&(o=x(this).attr("id")),x(f).jqGrid("delRowData",o)),i=0;i<x.data(f,"dnd").connectWith.length;i++)x(x.data(f,"dnd").connectWith[i]).jqGrid("delRowData","jqg_empty_row");r.onstop&&x.jgrid.isFunction(r.onstop)&&r.onstop.call(x(f),e,t)}},r.drag_opts||{})},drop:function(g){return x.extend({accept:function(e){if(!x(e).hasClass("jqgrow"))return e;var t=x(e).closest("table.ui-jqgrid-btable");if(0<t.length&&void 0!==x.data(t[0],"dnd")){var i=x.data(t[0],"dnd").connectWith;return-1!==x.inArray("#"+M(this.id),i)}return!1},drop:function(e,t){if(x(t.draggable).hasClass("jqgrow")){var i,o=x(t.draggable).attr("id"),r=t.draggable.parent().parent(),n=r.jqGrid("getRowData",o);if(!g.dropbyname){var d,a,l,s,u={},c=r.jqGrid("getGridParam","colModel"),p=x("#"+M(this.id)).jqGrid("getGridParam","colModel");try{for(a=d=0;d<c.length&&a<p.length;d++)if("cb"!==(l=c[d].name)&&"rn"!==l&&"subgrid"!==l){for(;a<p.length;a++)if("cb"!==(s=p[a].name)&&"rn"!==s&&"subgrid"!==s){u[s]=n[l];break}a++}n=u}catch(e){}}if(t.helper.dropped=!0,g.beforedrop&&x.jgrid.isFunction(g.beforedrop)){var h=g.beforedrop.call(this,e,t,n,x("#"+M(f.p.id)),x(this));null!=h&&"object"==typeof h&&(n=h)}if(t.helper.dropped)g.autoid&&(i=x.jgrid.isFunction(g.autoid)?g.autoid.call(this,n,{rowid:o,ev:e,ui:t}):(i=Math.ceil(1e3*Math.random()),g.autoidprefix+i)),x("#"+M(this.id)).jqGrid("addRowData",i,n,g.droppos),n[f.p.localReader.id]=i;g.ondrop&&x.jgrid.isFunction(g.ondrop)&&g.ondrop.call(this,e,t,n)}}},g.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{},drag_opts:{revert:"invalid",helper:"clone",cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5e3},dragcopy:!1,dropbyname:!1,droppos:"first",autoid:!0,autoidprefix:"dnd_"},o||{})).connectWith)for(o.connectWith=o.connectWith.split(","),o.connectWith=x.map(o.connectWith,function(e){return x.jgrid.trim(e)}),x.data(f,"dnd",o),0===f.p.reccount||f.p.jqgdnd||i(),f.p.jqgdnd=!0,e=0;e<o.connectWith.length;e++)t=o.connectWith[e],x(t).droppable(x.jgrid.isFunction(o.drop)?o.drop.call(x(f),o):o.drop)}else i()}function i(){var e=x.data(f,"dnd");x("tr.jqgrow:not(.ui-draggable)",f).draggable(x.jgrid.isFunction(e.drag)?e.drag.call(x(f),e):e.drag)}})},gridResize:function(s){return this.each(function(){var i,o=this,r=o.grid,n=o.p,d=n.gView+">.ui-jqgrid-bdiv",a=!1,l=n.height;if(r&&x.fn.resizable){if((s=x.extend({},s||{})).alsoResize?(s._alsoResize_=s.alsoResize,delete s.alsoResize):s._alsoResize_=!1,s.stop&&x.jgrid.isFunction(s.stop)?(s._stop_=s.stop,delete s.stop):s._stop_=!1,s.stop=function(e,t){x(o).jqGrid("setGridWidth",t.size.width,s.shrinkToFit),x(n.gView+">.ui-jqgrid-titlebar").css("width",""),a?(x(i).each(function(){x(this).css("height","")}),"auto"!==l&&"100%"!==l||x(r.bDiv).css("height",l)):x(o).jqGrid("setGridParam",{height:x(d).height()}),o.fixScrollOffsetAndhBoxPadding&&o.fixScrollOffsetAndhBoxPadding(),s._stop_&&s._stop_.call(o,e,t)},i=d,"auto"!==l&&"100%"!==l||void 0!==s.handles||(s.handles="e,w"),s.handles){var e=x.map(String(s.handles).split(","),function(e){return x.jgrid.trim(e)});2===e.length&&("e"===e[0]&&"w"===e[1]||"e"===e[1]&&"w"===e[1])&&(i=n.gView+">div:not(.frozen-div)",a=!0,n.pager&&(i+=","+n.pager))}s._alsoResize_?s.alsoResize=i+","+s._alsoResize_:s.alsoResize=i,delete s._alsoResize_,x(n.gBox).resizable(s)}})}})});
//# sourceMappingURL=grid.jqueryui.js.map